"use strict";var googletag=googletag||{};googletag.cmd=googletag.cmd||[],angular.module("ngDfp",[]).constant("ngDfpUrl","//www.googletagservices.com/tag/js/gpt.js").provider("DoubleClick",["ngDfpUrl",function(a){var b={},c={},d={},e=null,f=!0,g={},h=!1,i=!1,j=!0;this._createTag=function(b){if(f){var c=document.createElement("script"),d="https:"===document.location.protocol,e=document.getElementsByTagName("script")[0];c.async=!0,c.type="text/javascript",c.src=(d?"https:":"http:")+a,e.parentNode.insertBefore(c,e),c.onreadystatechange=function(){"complete"==this.readyState&&b()},c.onload=b}},this._initialize=function(){var a=this;googletag.cmd.push(function(){angular.forEach(b,function(a,b){c[b]=googletag.defineSlot.apply(null,a).addService(googletag.pubads()),d[b]&&c[b].defineSizeMapping(d[b]);var e=a.getSlotTargeting();e&&angular.forEach(e,function(a,d){c[b].setTargeting(a.id,a.value)})}),angular.forEach(g,function(a,b){googletag.pubads().setTargeting(b,a)}),h&&googletag.pubads().collapseEmptyDivs(),i&&googletag.pubads().setCentering(!0),j&&googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.pubads().addEventListener("slotRenderEnded",a._slotRenderEnded)})},this._slotRenderEnded=function(a){var c=b[a.slot.getSlotId().getDomId()].renderCallback;"function"==typeof c&&c(a)},this._refreshInterval=function(){return e},this.setRefreshInterval=function(a){return e=a,this},this.defineSlot=function(){var a=arguments;return a.getSize=function(){return this[1]},a.getSlotTargeting=function(){return!!this[3]&&this[3]},a.setRenderCallback=function(a){this.renderCallback=a},b[arguments[2]]=a,this},this.defineSizeMapping=function(){var a=arguments[0];return d[a]||(d[a]=[]),this.addSize=function(){return d[a].push([arguments[0],arguments[1]]),this},this},this.setEnabled=function(a){f=a},this.setPageTargeting=function(a,b){g[a]=b},this.collapseEmptyDivs=function(){h=!0},this.setCentering=function(a){i=a},this.setSingleRequest=function(a){j=a};var k=this;this.$get=["$q","$window","$interval",function(a,d,e){var f=a.defer();return k._createTag(function(){k._initialize(),null!==k._refreshInterval()&&e(function(){googletag.cmd.push(function(){d.googletag.pubads().refresh()})},k._refreshInterval()),f.resolve()}),{getAdSize:function(a){return f.promise.then(function(){var c=b[a];if(angular.isUndefined(c))throw"Slot "+a+" has not been defined. Define it using DoubleClickProvider.defineSlot().";return b[a][1]})},setPageTargeting:function(a,b){g[a]=b},getSlot:function(a){return f.promise.then(function(){var c=b[a];if(angular.isUndefined(c))throw"Slot "+a+" has not been defined. Define it using DoubleClickProvider.defineSlot().";return b[a]})},runAd:function(a){googletag.cmd.push(function(){d.googletag.display(a)})},refreshAds:function(){var a=[];angular.forEach(arguments,function(b){a.push(c[b])}),googletag.cmd.push(function(){d.googletag.pubads().refresh(a)})}}}]}]).directive("ngDfpAdContainer",function(){return{restrict:"A",controller:["$element",function(a){function b(b){"visibility"===b?a.css("visibility","hidden"):a.hide()}function c(b){"visibility"===b?a.css("visibility","visible"):a.show()}this.$$setVisible=function(a,d){a?c(d):b(d)}}]}}).directive("ngDfpAd",["$timeout","$parse","$interval","DoubleClick",function(a,b,c,d){return{restrict:"A",template:'<div id="{{adId}}"></div>',require:"?^ngDfpAdContainer",scope:{adId:"@ngDfpAd",refresh:"@ngDfpAdRefresh",interval:"@ngDfpAdRefreshInterval",timeout:"@ngDfpAdRefreshTimeout"},replace:!0,link:function(b,e,f,g){b.$watch("adId",function(h){e.html("");var i=null,j=null;d.getSlot(h).then(function(k){var l=k.getSize();e.css("width",l[0]).css("height",l[1]),a(function(){d.runAd(h)}),g&&k.setRenderCallback(function(){angular.isDefined(f.ngDfpAdHideWhenEmpty)&&(0===e.find("iframe:not([id*=hidden])").map(function(){return this.contentWindow.document}).find("body").children().length?g.$$setVisible(!1,f.ngDfpAdHideWhenEmpty):g.$$setVisible(!0,f.ngDfpAdHideWhenEmpty))}),b.$watch("refresh",function(a){angular.isUndefined(a)||d.refreshAds(h)}),b.$watch("interval",function(a){angular.isUndefined(a)||(i=c(function(){d.refreshAds(h)},b.interval))}),b.$watch("timeout",function(c){angular.isUndefined(c)||(j=a(function(){d.refreshAds(h)},b.timeout))}),b.$on("$destroy",function(){c.cancel(i),a.cancel(j),i=null,j=null})})})}}}]);